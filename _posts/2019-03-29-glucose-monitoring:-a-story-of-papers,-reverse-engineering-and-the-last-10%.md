---
layout: post
title: "Juventus: Glucose worries in Chiang Mai and the beginning of the biggest brownie point scheme ever"
date: 2019-03-03 18:45:15
image: 'Glucose/back1.png'
share_image: 'Glucose/back1.png'
description: 
tags:
- Freestyle Libre
- Diabetes
- Continuous Glucose Monitoring
- Juventus
- Ionic
categories:
- Software Builds
- Hacks of Life
twitter_text:
---

Okay so this one's been coming for a while. A LONG while. [Juventus](https://play.google.com/store/apps/details?id=com.juventus.app) (finally released, yay! - well sort of) was a project that started over two years ago in college. Like anything, it started with a lot of huge hurdles and big ambition, and as a product built for only one person. Story of everything, I guess - except in this case, the hurdles were overcome but the ambition never fully worked out. Unlike most tech products that start with one customer, it wasn't me I was building it for - but she's been a happy user for a year now. Win some, lose some. Mostly I think looking back is going to be fun.

## Part One - The freakout in Chiang Mai

![in the middle of chiang mai]({{site.url}}/assets/img/Glucose/chiangmai.png)

We've been on the path up the mountain for a few hours when we decide to stop for a little while to drink some coke, look around and maybe let the drone out for a little bit. I'm unpacking the back of the motorcycle (which is usually a pain, but I remember I'd gotten clever with the carabiners that morning so it's going surprisingly well) when I hear her start to freak out. She can't find her Reader (or Bippity as it's come to be known). I calm her a little and we slowly go through our luggage and empty it out (and in the process find a lot of things I'd come to learn to live without by now, so I'm overjoyed to see them) but the one thing I don't see is the reason why I'm also starting to worry. She needs her reader. She needs it because she's Type 1 diabetic, and this reader is what tells her if she's going low. It's even more worrying when I realise the reason she thought to look for it is because she thought she might be going low. Going low - as she calls it - is [hypoglycemia](https://en.wikipedia.org/wiki/Hypoglycemia), and it's not a fun place to be. At least an hour's ride from anywhere on two wheels in Asia, it's something that scares even me. 

She worries, then cries for a bit - thankfully we're not low on sugar so she takes some - and manages to find a blood-based reader, then sleeps for a while from the exhaustion. Meanwhile I decide to take a look at the thing when we get home. I'd been really excited about the technology and had wanted to for a while, but I hadn't really realised the life threatening danger she's been living next to for most of her life. 

Some background? Type 1 diabetics need to have an accurate idea of where their blood glucose is so they can make sure they don't stray outside the acceptable range. Too high can cause neuronal death if it's a frequent occurrence, and too low is even worse - you slip into  a coma and die, sometimes faster than you can do anything about it. The now traditional method is to use a [Blood Glucose Meter](https://en.wikipedia.org/wiki/Glucose_meter) (BGM), the testing strips and the drops of blood it requires having been symbolic of diabetics everywhere for the past few decades. However, they provide single points of information - kind of like asking someone how hungry they are at the moment, even more so if you only ever ask that question after jabbing a needle into them. When it comes to hunger, most of the time that single point is enough. I remember it wasn't for my mum though. She'd always follow up with 'how hungry are you likely to be in an hour? two hours?'. I think she was trying to (and rightfully so) make sure I didn't say no so I could run around and then wake her up at 2 am because I was suddenly malnutritioned. For a diabetic, that second order information, the gradient or slope of their sugar levels is crucial information. Being level for two hours at 4 mmol/L is awesome, slowly heading up at 4 would make you want to consider an insulin shot sometime soon, and heading straight down at 4 is cause for serious alarm. Yet BGMs only provide that one point of information, and they extract the iron price each time you ask.

In the recent past, [Continuous Glucose Monitors](https://en.wikipedia.org/wiki/Continuous_glucose_monitor)(CGM) have added that missing differential, and that has made a world of difference (heh heh). CGMs - or a good portion of them - continuously measure and provide a readout of your current sugar levels. Some of them, like the [Dexcom G6](https://www.cnbc.com/2018/05/12/dexcom-g6-review-a-cgm-that-doesnt-require-finger-pricks.html) have a long needle thingy and a pack that you wear on your hip. Some others, like the [Freestyle Libre](https://freestylelibre.com.sg/) are about the size of a large coin, weigh about the same and slick onto your arm or your stomach to be read by a wireless reader whenever you wanted to know how you were doing. It was the latter and its accompaniying reader that started this whole thing. We got home later that week. We had to cut the trip short due to the lost reader, and this was multiple reasons, none of which could really be easily avoided. The reader was expensive and hard to purchase. It was only available for sale in very few countries - thankfully Singapore had become one of them about a week before we left - but Thailand was definitely not one of them. This is not to mention that the sensors - which again, were a hundred bucks a pop and lasted only two weeks - paired themselves to the reader when you used them and refused to be read by any other reader (even a legitimate one from the same company). Finally, for a user accustomed to making decisions based on CGM data, it's hard to move the mental models to BGMs. It's hard, somewhat dangerous and definitely not something you want to endure on a fun roadtrip.

![the sensor and the reader]({{site.url}}/assets/img/Glucose/fsl.png)

So we went home and got a reader - and an additional reader and a sensor for me.

## Part Two - Continuous Glucose Monitors: The godsend that could definitely be improved

The way that CGMs work - and we ended up writing a [paper]({{site.url}}/assets/docs/Glucose/CGMStudy.pdf) on this so do check it out if you're interested in the details, I'll just summarise how they work here - is by measuring interstitial fluid glucose. [Interstitial fluid](https://en.wikipedia.org/wiki/Extracellular_fluid#Interstitial_fluid) is the sort of plasma around your cells that acts as an intermediary between your blood and your cells. Honestly, I have to keep myself from gushing about the tech here. The Freestyle Libre sensor uses interstitial fluid as an electrolyte, essentially using the glucose concentration to move ions from an anode to a cathode. Or the other way around, I always get those wrong - honestly I could look them up right now and I'd still mix them up before I get back to the page (damn you Ben!)

![urgent mission xkcd]({{site.url}}/assets/img/Glucose/urgent_mission.png)

Effectively, the sensor uses your interstitial fluid and the sugar in it to power a battery, whose emf potential can then indicate the concentration. I'm sure it's much, MUCH more complex than that - honestly the amount of science, research and engineering that went into this thing - in chemical, biological, electrical and software engineering - is amazing that it ever came together. It's honestly one of those inventions that if you'd told me about building one before it existed I'd shake my head and tell you that it might be THEORETICALLY possible, but there's no way you'd solve that many technical challenges, get the tolerances right or get an accurate enough value for it to be a commercial product. Same goes for GPS - that handphones could use lightspeed and orbiting atomic clocks with relativistic calculations to measure position to centimetre precision, and that I can buy one and use it to look at cats still keeps me up at night sometimes. But it was real, and now that I was taking a good look at one, I couldn't help but wonder how it could get better. And as the first version of anything is, it could get much better - and it seemed to me - pretty easily. The first guy through the wall is always bloody. I was the second or fifth guy here, and I could mitre out good joints and build a solid doorway.

So, what were some of the problems? 

Let's get around the big blue elephant here. The proprietary nature of the sensors and the readers was a big problem. The readers and the sensors were expensive - like crazy expensive - and they refused to work at even the slightest suggestion of an issue. A reader could only be paired to a single sensor at one time (adding another one meant it refused to register the previous one). The sensors also refused to give you values after 14 days of operation, and the entire system was, safe to say, not open. This was a big problem. Not that I blame big pharma for it though. I have no idea what it took to get this thing through FDA approval, and I'm sure they added big fat conservative margins to operating parameters to be on the safe side. This was also a new product that significantly improved the lives of its wearers (all of whom are definitely lifelong consumers), so I can't blame them for finding a highest price they can sell it for, as a for-profit enterprise.

Most of the players in this market have their hands tied - the companies might eventually start tightening things and bringing costs down, but only if they see update their customer personas to lower income users, and all of the users I know are regular diabetics that treat it the same way I would treat a dog - you're happy for the service, but you've never considered taking one apart and trying to improve it.

![interferometry xkcd]({{site.url}}/assets/img/Glucose/interferometry.png)

Here's a few others, while we're talking about problems. The sensors include some temperature compensation (as per the datasheet and some sources - it's all in the paper), but the output still varies wildly within even expected ranges, like getting into a cold pool or a warm shower. The reader will sometimes pretend that values it showed didn't exist. We caught it editing raw history multiple times, and on top of not liking tech that frequently gaslighted you, this was potentially problematic for your doctor who needed to review your data later on and yourself for having a consistent history of how you felt and what the reader was telling you. Some work also revealed that the calibration on the readers was a simple two point calibration (first order regression), when the relationship between blood glucose and interstitial glucose requires at least one multidimensional second order differential to describe it (again, paper). Finally, the sensors were usually accurate to at least a week after they "ended" - the power was still on, good values were still being read - but there was no way to use it in a pinch when you'd forgotten one or if you were poor and trying to stretch its life.

Here began my attempt at fixing some - no wait not some that would be reasonable, ALL - of these problems. More on that later. Honestly if you're not good at waiting on an unreliable narrator, the [paper]({{site.url}}/assets/docs/Glucose/CGMStudy.pdf) and the [app](https://play.google.com/store/apps/details?id=com.juventus.app) (SPOILER ALERT) should really tell most of the story minus the human element.